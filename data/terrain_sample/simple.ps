#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D normal_map;
uniform sampler2D texture;
uniform sampler2D texture2;

varying highp vec2 va_TexCoord;
varying highp vec3 va_Normal;
varying highp vec3 va_TSLightDir;

void main()
{
	float fade = va_Normal.y * va_Normal.y;
	vec3 bumpNor = (texture2D(normal_map, va_TexCoord ).rgb - 0.5) * 2.0;
	vec3 t1 = 0.5 * ( texture2D(texture, va_TexCoord ).rgb +  texture2D(texture, va_TexCoord * 5.0 ).rgb );
	vec3 t2 = 0.5 * ( texture2D(texture2, va_TexCoord ).rgb +  texture2D(texture2, va_TexCoord * 5.0 ).rgb );
	
    gl_FragColor.a = 1.0;
	gl_FragColor.rgb = ( mix( t1, t2, fade + 0.2 ) 
	  
		)
		* dot(normalize(va_TSLightDir), normalize(bumpNor));
}

